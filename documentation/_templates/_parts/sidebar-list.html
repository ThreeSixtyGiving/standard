{% macro tocentry(el, level=0) %}

  {% set nextlevel = level %}

  {% if el.tagname == 'bullet_list' %}
  {% set nextlevel = level + 1 %}
  {% if level == 0 %}
  <ul class="sidebar-blog__content categories-list level-{{ nextlevel }}">
    {% for i in el %}{{ tocentry(i, nextlevel) }}{% endfor %}
  </ul>
  {% else %}
  <ul class="level-{{ nextlevel }}">
    {% for i in el %}{{ tocentry(i, nextlevel) }}{% endfor %}
  </ul>
  {% endif %}

  {% elif el.tagname == 'list_item' %}
  <li class="{% if level == 1 %}categories-list__item category{% endif %} level-{{ level }} {% if el.get('iscurrent') and level == 1 %}category--active{% endif %}">
    {% for i in el %}{{ tocentry(i, nextlevel) }}{% endfor %}
  </li>

  {% elif el.tagname == 'compact_paragraph' %}
    {% for i in el %}{{ tocentry(i, level) }}{% endfor %}
  
  {% elif el.tagname == 'reference' %}
    <a href="{{ el.get('refuri') }}">{{ el.astext() }}</a>

  {% else %}
    {{ el.tagname }}
  {% endif %}
{% endmacro %}

{% set global_toc = get_toctree(maxdepth=3,
                            collapse=true,
                            includehidden=false,
                            titles_only=false) %}

{{ tocentry(global_toc) }}
